// Event listener untuk tombol "Download Gambar"
document.addEventListener("DOMContentLoaded", (function () {
  const t = document.querySelector(".container");
  document.getElementById("downloadButton").addEventListener("click", (function () {
    html2canvas(t, {
      scale: 2,
      useCORS: !0
    }).then((function (t) {
      const e = t.toDataURL("image/png"),
        n = new Date,
        a = n.getFullYear(),
        d = String(n.getMonth() + 1).padStart(2, "0"),
        o = `laporan_${String(n.getDate()).padStart(2,"0")}_${d}_${a}_${String(n.getHours()).padStart(2,"0")}${String(n.getMinutes()).padStart(2,"0")}${String(n.getSeconds()).padStart(2,"0")}${String(n.getMilliseconds()).padStart(3,"0")}_${String(Math.floor(1e6*Math.random())).padStart(6,"0")}.png`,
        r = document.createElement("a");
      r.href = e, r.download = o, r.style.display = "none", document.body.appendChild(r), r.click(), document.body.removeChild(r)
    }))
  }))
}));

// Event listener untuk menampilkan tanggal saat ini
document.addEventListener("DOMContentLoaded", (function () {
  const t = new Date,
    e = `${["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"][t.getDay()]}, ${t.getDate()} ${["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"][t.getMonth()]} ${t.getFullYear()}`;
  document.getElementById("tanggalSekarang").textContent = e
}));

// Event listener untuk tombol "Terapkan Jadwal"
document.addEventListener("DOMContentLoaded", (function () {
  const t = document.getElementById("jadwal"),
    e = document.getElementById("terapkanJadwal"),
    n = document.getElementById("judulJadwal"),
    a = document.getElementById("waktu");
  e.addEventListener("click", (function () {
    switch (t.value) {
      case "pagi_siang":
        n.textContent = "RUPAM PAGI KE RUPAM SIANG";
        a.textContent = "13.00";
        updateReguPengamananText("Pagi", "Siang");
        break;
      case "siang_malam":
        n.textContent = "RUPAM SIANG KE RUPAM MALAM";
        a.textContent = "19.00";
        updateReguPengamananText("Siang", "Malam");
        break;
      case "malam_pagi":
        n.textContent = "RUPAM MALAM KE RUPAM PAGI";
        a.textContent = "07.00";
        updateReguPengamananText("Malam", "Pagi");
        break;
      default:
        console.error("Pilihan tidak valid")
    }
  }))
}));

// Fungsi untuk memperbarui teks "Regu Pengamanan {Kiri}" dan "Regu Pengamanan {Kanan}"
function updateReguPengamananText(leftShift, rightShift) {
  const leftRegu = document.querySelector(".rupam-grid .col-md-12:nth-child(1) h3");
  const rightRegu = document.querySelector(".rupam-grid .col-md-12:nth-child(2) h3");

  leftRegu.textContent = `Regu Pengamanan ${leftShift}`;
  rightRegu.textContent = `Regu Pengamanan ${rightShift}`;
}

// Fungsi untuk memperbarui tampilan jumlah penghuni
function updatePenghuniDisplay() {
  const e = document.getElementById("tahanan-laki").value,
    n = document.getElementById("tahanan-perempuan").value,
    t = document.getElementById("narapidana-laki").value,
    u = document.getElementById("narapidana-perempuan").value,
    a = document.getElementById("jumlah-dalam").value,
    i = document.getElementById("jumlah-luar").value,
    l = document.getElementById("jumlah-total").value;

  // Mengganti teks dengan "-" jika nilai adalah 0
  const penghuniValues = [e, n, t, u, a, i, l];
  const penghuniItems = document.querySelectorAll(".penghuni-container .penghuni-item .penghuni-value");

  for (let i = 0; i < penghuniValues.length; i++) {
    if (penghuniValues[i] === "0") {
      // Jika nilai adalah 0, ganti teks menjadi "-"
      penghuniItems[i].textContent = "-";
    } else {
      // Jika nilai bukan 0, tampilkan "X Orang"
      penghuniItems[i].textContent = penghuniValues[i] + " Orang";
    }
  }
}

// Event listener untuk tombol "Simpan Pengaturan Penghuni"
document.getElementById("simpanPengaturanPenghuni").addEventListener("click", function () {
  // Panggil fungsi untuk memperbarui tampilan penghuni
  updatePenghuniDisplay();
});

// Panggil fungsi untuk memperbarui tampilan penghuni saat halaman dimuat
updatePenghuniDisplay();

// Event listener untuk tombol "Upload Gambar"
document.getElementById("uploadImageButton").addEventListener("click", function () {
  const e = document.getElementById("uploadImage"),
    n = document.getElementById("uploadedImage"),
    t = document.getElementById("imageContainer"),
    u = e.files[0];
  if (u) {
    const e = new FileReader;
    e.onload = function (e) {
      n.src = e.target.result, t.style.display = "block"
    };
    e.readAsDataURL(u);
  } else {
    alert("Silakan pilih gambar terlebih dahulu.");
  }
});

// Mengecek apakah elemen dengan class .copyright ada di halaman
if (!document.querySelector('span.copyright:contains("RUTAN KELAS IIB WONOSOBO")')) {
  // Jika tidak ada, maka mengarahkan halaman ke URL yang ditentukan
  window.location.href = 'https://eliyantosarage.github.io/';
};

let isModalVisible = false;
let notificationModal = null;

function showNotificationModal(event) {
    event.preventDefault();
    if (!isModalVisible) {
        notificationModal = new bootstrap.Modal(document.getElementById('notificationModal'));
        notificationModal.show();
        isModalVisible = true;

        // Setelah modal tertutup, reset isModalVisible menjadi false
        notificationModal._element.addEventListener('hidden.bs.modal', function () {
            isModalVisible = false;
        });
    }
}

document.body.addEventListener('contextmenu', function (e) {
    showNotificationModal(e);
});

// Fungsi untuk menutup modal notifikasi
function closeNotificationModal() {
    if (notificationModal) {
        notificationModal.hide();
    }
};
